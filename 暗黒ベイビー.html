

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ã¯ã‚‹ã¿ã‚¿ã‚¤ãƒ”ãƒ³ã‚°</title>
  <style>
    body {
      font-family: sans-serif;
      background: linear-gradient(#e0f7fa, #ffffff);
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: black;
      opacity: 0;
      transition: opacity 0.5s ease-in;
    }
    body.ready {
      opacity: 1;
    }
    body.dragon-background {
      background: url("doukutu.png") no-repeat center center fixed;
      background-size: cover;
    }
    body.wizard-background {
      background: url("") no-repeat center center fixed;
      background-size: cover;
    }
    body.devilsans-background {
      background: url("devilsans-background.png") no-repeat center center fixed;
      background-size: cover;
    }

    .story-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      color: white;
      display: none;
      justify-content: center;
      align-items: center;
      text-align: center;
      font-size: 2.5em;
      opacity: 0;
      transition: opacity 1s ease-in-out;
      z-index: 10;
    }

    .story-text {
      opacity: 0;
      transition: opacity 2s ease-in-out;
      padding: 20px;
    }

    .story-screen.fade-in {
      opacity: 1;
    }
    .story-screen.fade-out {
      opacity: 0;
    }

    .game-container {
      max-width: 800px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 16px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: relative;
      display: none;
    }

    .start-screen {
      text-align: center;
      padding: 50px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 16px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 600px;
      width: 90%;
      display: none;
    }

    .start-screen h1 {
      font-size: 3em;
      margin-bottom: 20px;
    }

    .start-screen button {
      padding: 15px 30px;
      font-size: 1.5em;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background-color: #4CAF50;
      color: white;
      transition: background-color 0.3s;
    }

    .start-screen button:hover {
      background-color: #45a049;
    }

    .character-images {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .character-images img {
      width: 100px;
      image-rendering: pixelated;
    }

    .damage-effect {
      position: absolute;
      font-size: 1.4em;
      font-weight: bold;
      color: red;
      animation: float-up 0.8s ease-out forwards;
      pointer-events: none;
      z-index: 20;
    }

    @keyframes float-up {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-40px); }
    }

    h1 {
      text-align: center;
      font-size: 2em;
      margin-bottom: 10px;
    }

    #kana-text, #target-text, #combo {
      text-align: center;
      font-size: 1.2em;
      margin: 8px 0;
    }
    #status {
      text-align: center;
      font-size: 1.8em;
      font-weight: bold;
      margin: 8px 0;
    }

    #target-text span {
      color: #ccc;
    }

    #input {
      opacity: 0;
      position: absolute;
    }

    .hp-container {
      margin: 10px 0;
    }

    progress {
      width: 100%;
      height: 20px;
      appearance: none;
      border-radius: 10px;
      background: #eee;
    }

    progress::-webkit-progress-value {
      background: #53a318;
      border-radius: 10px;
    }

    .status-panel {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="story-screen" id="story-screen">
    <div id="story-text" class="story-text"></div>
  </div>

  <div class="start-screen" id="start-screen">
    <h1>ğŸ”¥ã¯ã‚‹ã¿ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ğŸ”¥</h1>
    <button id="start-button">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  </div>

  <div class="game-container" id="game-container">
    <h1>ğŸ”¥ã¯ã‚‹ã¿ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ğŸ”¥</h1>

    <div class="status-panel">
      <div>ãƒ¬ãƒ™ãƒ«: <span id="level">1</span></div>
      <div>çµŒé¨“å€¤: <span id="exp">0</span></div>
      <div>ã‚¹ãƒ†ãƒ¼ã‚¸: <span id="stage">3</span></div>
    </div>

    <div class="character-images">
      <img id="player-image" src="hero.png" alt="ã‚ãªãŸ">
      <img id="enemy-image" src="" alt="æ•µ" />
    </div>

    <div id="enemy-name">??? ãŒç¾ã‚ŒãŸï¼</div>
    <div id="kana-text">ãŠé¡Œï¼šloading...</div>
    <div id="target-text">loading...</div>

    <input id="input" type="text" autocomplete="off" autofocus />

    <div class="hp-container">
      <div>ã‚ãªãŸã®HP: <span id="player-hp-text">80000</span></div>
      <progress id="player-hp-bar" max="80000" value="80000"></progress>
    </div>
    <div class="hp-container">
      <div>æ•µã®HP: <span id="enemy-hp-text">100</span></div>
      <progress id="enemy-hp-bar" max="100" value="100"></progress>
    </div>

    <div id="combo">ã‚³ãƒ³ãƒœ: 0</div>
    <div id="status"></div>
  </div>

<audio id="background-music" src="æš—é»’ãƒ™ã‚¤ãƒ“ãƒ¼.mp3" loop preload="auto"></audio>
    
    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«å®Ÿè¡Œ
        window.onload = function() {
            const audio = document.getElementById('background-music');

            // ãƒšãƒ¼ã‚¸ä¸Šã®ã©ã“ã‹ãŒã‚¯ãƒªãƒƒã‚¯ï¼ˆã‚¿ãƒƒãƒ—ï¼‰ã•ã‚ŒãŸæ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            document.body.addEventListener('click', function handleFirstClick() {
                // éŸ³æ¥½ã®å†ç”Ÿã‚’è©¦ã¿ã‚‹
                audio.play().then(() => {
                    console.log("ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã«ã‚ˆã‚ŠéŸ³æ¥½ã‚’å†ç”Ÿã—ã¾ã—ãŸã€‚");
                    // å†ç”Ÿã«æˆåŠŸã—ãŸã‚‰ã€ã“ã‚Œä»¥é™è‡ªå‹•å†ç”Ÿãƒãƒªã‚·ãƒ¼ã¯é©ç”¨ã•ã‚Œãªã„ãŸã‚ã€
                    // ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã¯å‰Šé™¤ã™ã‚‹ (ä¸€åº¦ã ã‘å®Ÿè¡Œã•ã›ã‚‹)
                    document.body.removeEventListener('click', handleFirstClick);
                }).catch(error => {
                    // å†ç”Ÿå¤±æ•—æ™‚ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã£ã¦ã¯ã€ã¾ã ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œãŒä¸ååˆ†ãªå ´åˆãªã©ï¼‰
                    console.error("éŸ³æ¥½ã®å†ç”Ÿã«å¤±æ•—ã—ã¾ã—ãŸ:", error);
                });
            });
        };
    </script>



  <script>
    const kanaToRomajiMap = {
      ã‚:['a'],ã„:['i'],ã†:['u'],ãˆ:['e'],ãŠ:['o'],
      ã‹:['ka'],ã:['ki'],ã:['ku'],ã‘:['ke'],ã“:['ko'],
      ã•:['sa'],ã—:['shi','si'],ã™:['su'],ã›:['se'],ã:['so'],
      ãŸ:['ta'],ã¡:['chi','ti'],ã¤:['tsu','tu'],ã¦:['te'],ã¨:['to'],
      ãª:['na'],ã«:['ni'],ã¬:['nu'],ã­:['ne'],ã®:['no'],
      ã¯:['ha'],ã²:['hi'],ãµ:['fu','hu'],ã¸:['he'],ã»:['ho'],
      ã¾:['ma'],ã¿:['mi'],ã‚€:['mu'],ã‚:['me'],ã‚‚:['mo'],
      ã‚„:['ya'],ã‚†:['yu'],ã‚ˆ:['yo'],
      ã‚‰:['ra'],ã‚Š:['ri'],ã‚‹:['ru'],ã‚Œ:['re'],ã‚:['ro'],
      ã‚:['wa'],ã‚’:['wo','o'],ã‚“:['n','nn'],
      ãŒ:['ga'],ã:['gi'],ã:['gu'],ã’:['ge'],ã”:['go'],
      ã–:['za'],ã˜:['ji','zi'],ãš:['zu','du'],ãœ:['ze'],ã:['zo'],
      ã :['da'],ã¢:['ji','di'],ã¥:['zu','du'],ã§:['de'],ã©:['do'],
      ã°:['ba'],ã³:['bi'],ã¶:['bu'],ã¹:['be'],ã¼:['bo'],
      ã±:['pa'],ã´:['pi'],ã·:['pu'],ãº:['pe'],ã½:['po'],
      ãã‚ƒ:['kya'],ãã‚…:['kyu'],ãã‚‡:['kyo'],
      ã—ã‚ƒ:['sha','sya'],ã—ã‚…:['shu','syu'],ã—ã‚‡:['sho','syo'],
      ã¡ã‚ƒ:['cha','tya'],ã¡ã‚…:['chu','tyu'],ã¡ã‚‡:['cho','tyo'],
      ã«ã‚ƒ:['nya'],ã«ã‚…:['nyu'],ã«ã‚‡:['nyo'],
      ã²ã‚ƒ:['hya'],ã²ã‚…:['hyu'],ã²ã‚‡:['hyo'],
      ã¿ã‚ƒ:['mya'],ã¿ã‚…:['myu'],ã¿ã‚‡:['myo'],
      ã‚Šã‚ƒ:['rya'],ã‚Šã‚…:['ryu'],ã‚Šã‚‡:['ryo'],
      ãã‚ƒ:['gya'],ãã‚…:['gyu'],ãã‚‡:['gyo'],
      ã˜ã‚ƒ:['ja','jya','zya'],ã˜ã‚…:['ju','jyu','zyu'],ã˜ã‚‡:['jo','jyo','zyo'],
      ã³ã‚ƒ:['bya'],ã³ã‚…:['byu'],ã³ã‚‡:['byo'],
      ã´ã‚ƒ:['pya'],ã´ã‚…:['pyu'],ã´ã‚‡:['pyo'],
    };

    const enemies = [
      { name: "æš—é»’ãƒ™ã‚¤ãƒ“ãƒ¼", maxHp: 175000, img: "æš—é»’ãƒ™ã‚¤ãƒ“ãƒ¼.png", attack: 280, exp: 10000 }
    ];
    
    const texts = ["ã¤ãã—ã¾ã ã„ã•ã‚“ã—ã‚‡ã†ãŒã£ã“ã†", "ã¯ã‚‹ã¿ã®ã‚Œãã—", "ã†ã‚ãŸã¦ã¡", "ã‚ãŠãã‚‰", "ã¤ãã—ã¾", "ã¯ã‚‹ã¿ã¯ã†ã¿ã«ã‹ã“ã¾ã‚Œã¦ã„ã‚‹", "ã‚‚ã‚“ã˜ã‚ƒã¯ãŠã„ã—ã„ãª","ã¯ã‚‹ã¿ã¨ã‚Šã¨ã‚“","ã¤ãã—ã¾ã‚ˆã‚“ã”ã†ã¡","ã†ã‚ãŸã¦ã¡","ã¯ã‚‹ã¿ã¡ã‚…ã†ãŒã£ã“ã†","ã¯ã‚‹ã¿ãã†ã”ã†ã“ã†ã“ã†","ã¯ã‚‹ã¿ãµã¨ã†","ã¯ã‚‹ã¿ãµã¨ã†ã“ã†ãˆã‚“","ã¤ãã—ã¾ãã‚‰ã†ã‚“ã©","ã‚Œã„ã‚ã„ã°ã—ã“ã†ãˆã‚“","ã‚Šã‚“ã‹ã„ã“ã†ãˆã‚“","ã¯ã‚‹ã¿ã—ã‚‡ã†ã­ã‚“ãã‚‰ã†ã‚“ã©","ã¯ã‚‹ã¿ãµã‚‰ã£ã","ã‚ã‚‹ãã»ã©ã†","ã¨ã‚Šã¨ã‚“ã¶ã‚Šã£ã˜"];
    
    const storyText = [
      "20XXå¹´ã€ç›´ä¸‹æ™´æµ·åœ°éœ‡ãŒç™ºç”Ÿã—ãŸã€‚",
      "äººé¡ã¯äºˆæƒ³ã›ãšå¤§æ‰“æ’ƒã‚’å—ã‘ã€",
      "ãã®ä¸Šã€æ™´æµ·ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼è¨³ã—ã¦ãƒãƒ«ã‚‚ã‚“ãŒç¾ã‚ŒãŸ",
      "ãƒ¦ã‚¦ã‚­ã¯ãƒãƒ«ã‚‚ã‚“ã‚’å€’ã™ã¹ãæ—…ã«å‡ºã‚‹ï¼",
    ];

    const player = { hp: 200000, maxHp: 200000, attack: 5, level: 99, exp: 0, nextExp: 1000 };
    let currentEnemy = {}, combo = 0, romajiList = [], romajiProgress = "";
    let stage = 3;
    let enemyAttackInterval;
    let storyTimeouts = [];

    const $ = id => document.getElementById(id);
    
    function convertKanaToRomajiList(kana) {
        const result = [];
        let i = 0;
        while (i < kana.length) {
            let found = false;

            // ä¿ƒéŸ³ã®å‡¦ç†: ã€Œã£ã€ï¼‹æ¬¡ã®æ–‡å­—ã®æœ€åˆ
            if (kana[i] === 'ã£' && i + 1 < kana.length) {
                const nextKana = kana.slice(i + 1, i + 2);
                const nextRomajiCandidates = kanaToRomajiMap[nextKana];
                if (nextRomajiCandidates) {
                    const firstRomajiChar = nextRomajiCandidates[0].charAt(0);
                    result.push([firstRomajiChar, firstRomajiChar]);
                    i++;
                    found = true;
                }
            }

            if (!found) {
                // 2æ–‡å­—ã‹ãªã®å‡¦ç† (æ‹—éŸ³ãªã©)
                const two = kana.slice(i, i + 2);
                if (kanaToRomajiMap[two]) {
                    result.push(kanaToRomajiMap[two]);
                    i += 2;
                    found = true;
                }
            }

            if (!found) {
                // 1æ–‡å­—ã‹ãªã®å‡¦ç†
                const one = kana.slice(i, i + 1);
                if (kanaToRomajiMap[one]) {
                    result.push(kanaToRomajiMap[one]);
                    i += 1;
                    found = true;
                }
            }
            
            // å¤‰æ›ã§ããªã„æ–‡å­—ï¼ˆæ¼¢å­—ãªã©ï¼‰ã¯ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹
            if (!found) {
                i++;
            }
        }
        return result;
    }

    function setNewEnemy() {
      const enemyIndex = Math.floor(Math.random() * enemies.length);
      currentEnemy = { ...enemies[enemyIndex] };
      currentEnemy.hp = currentEnemy.maxHp;
      $("enemy-image").src = currentEnemy.img;
      $("enemy-hp-bar").max = currentEnemy.maxHp;
      $("enemy-hp-bar").value = currentEnemy.hp;
      $("enemy-hp-text").textContent = currentEnemy.hp;
      $("enemy-name").textContent = `${currentEnemy.name} ãŒç¾ã‚ŒãŸï¼`;
      document.body.classList.remove("dragon-background", "wizard-background", "devilsans-background");
      if (currentEnemy.name === "ãƒ‡ãƒ“ãƒ«ã‚µãƒ³ã‚º") document.body.classList.add("devilsans-background");
      resetEnemyAttackTimer();
    }

    function setNewText() {
      const kana = texts[Math.floor(Math.random() * texts.length)];
      $("kana-text").textContent = `ãŠé¡Œï¼š${kana}`;
      romajiList = convertKanaToRomajiList(kana);
      romajiProgress = "";
      updateTargetText();
    }
    
    function updateTargetText() {
        if (romajiList.length === 0) {
            $("target-text").innerHTML = "";
            return;
        }
        let typedRomajiPart = '';
        let remainingRomajiPart = '';
        let typedIndex = 0;
        let romajiIndex = 0;
        while(romajiIndex < romajiList.length && typedIndex < romajiProgress.length) {
            const romajiOptions = romajiList[romajiIndex];
            const remainingTyped = romajiProgress.slice(typedIndex);
            const bestMatch = romajiOptions.find(option => remainingTyped.startsWith(option));
            if (bestMatch) {
                typedRomajiPart += bestMatch;
                typedIndex += bestMatch.length;
                romajiIndex++;
            } else {
                const partialMatch = romajiOptions.find(option => option.startsWith(remainingTyped));
                if (partialMatch) {
                    typedRomajiPart += remainingTyped;
                    typedIndex += remainingTyped.length;
                }
                break;
            }
        }
        for (let i = romajiIndex; i < romajiList.length; i++) {
            remainingRomajiPart += romajiList[i][0];
        }
        $("target-text").innerHTML = `<span style="color: #ccc;">${typedRomajiPart}</span>${remainingRomajiPart}`;
    }

    function showDamage(dmg, isPlayerDamage = false) {
      const e = document.createElement("div");
      e.className = "damage-effect";
      e.textContent = `-${dmg}`;
      if (isPlayerDamage) {
        e.style.color = 'blue';
        const playerImageRect = $("player-image").getBoundingClientRect();
        e.style.top = `${playerImageRect.top + window.scrollY}px`;
        e.style.left = `${playerImageRect.left + playerImageRect.width / 2 + window.scrollX}px`;
      } else {
        e.style.color = 'red';
        const enemyImageRect = $("enemy-image").getBoundingClientRect();
        e.style.top = `${enemyImageRect.top + window.scrollY}px`;
        e.style.left = `${enemyImageRect.left + enemyImageRect.width / 2 + window.scrollX}px`;
      }
      document.body.appendChild(e);
      e.addEventListener('animationend', () => e.remove());
    }

    function updateStatus() {
      $("player-hp-text").textContent = player.hp;
      $("player-hp-bar").value = player.hp;
      $("enemy-hp-text").textContent = currentEnemy.hp;
      $("enemy-hp-bar").value = currentEnemy.hp;
      $("combo").textContent = `ã‚³ãƒ³ãƒœ: ${combo}`;
      $("level").textContent = player.level;
      $("exp").textContent = player.exp;
      $("stage").textContent = stage;
    }
    
    function handleInput(e) {
      const key = e.key.toLowerCase();
      if (key === 'backspace') {
          if (romajiProgress.length > 0) {
              romajiProgress = romajiProgress.slice(0, -1);
              updateTargetText();
          }
          return;
      }
      if (!/^[a-z]$/.test(key)) {
          return;
      }
      if (romajiList.length === 0) {
          return;
      }
      const currentRomajiOptions = romajiList[0];
      const typedRomaji = romajiProgress + key;
      const isCorrectPartial = currentRomajiOptions.some(option => option.startsWith(typedRomaji));

      if (isCorrectPartial) {
          romajiProgress = typedRomaji;
          updateTargetText();
          
          const isCompleted = currentRomajiOptions.some(option => option === romajiProgress);
          if (isCompleted) {
              const damage = player.attack + combo * 5;
              currentEnemy.hp = Math.max(currentEnemy.hp - damage, 0);
              showDamage(damage);
              romajiList.shift();
              romajiProgress = "";
              combo++;
              player.exp += 10;
              
              if (romajiList.length === 0) {
                  player.exp += currentEnemy.exp;
                  if (currentEnemy.hp <= 0) {
                      handleEnemyDefeat();
                  }
                  setNewText();
              }
          }
      } else {
          combo = 0;
          $("status").textContent = "ãƒŸã‚¹ï¼";
          setTimeout(() => {
              $("status").textContent = "";
          }, 500);
          romajiProgress = "";
          updateTargetText();
      }
      updateStatus();
      if (player.hp <= 0) {
          handleGameOver();
      }
    }

    function handleEnemyDefeat() {
      $("status").textContent = `${currentEnemy.name} ã‚’å€’ã—ãŸï¼`;
      player.exp += currentEnemy.exp;
      checkLevelUp();
      if (stage < 1) {
        stage++;
        setTimeout(() => {
          $("status").textContent = `æ¬¡ã®æ•µãŒç¾ã‚ŒãŸï¼ ã‚¹ãƒ†ãƒ¼ã‚¸${stage}`;
          setNewEnemy();
          setNewText();
          updateStatus();
        }, 1500);
      } else {
        handleGameClear();
      }
    }

    function handleGameOver() {
      clearInterval(enemyAttackInterval);
      $("status").textContent = "ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼...";
      $("input").disabled = true;
      document.body.style.backgroundColor = "#333";
      document.body.style.color = "#fff";
    }

    function handleGameClear() {
      clearInterval(enemyAttackInterval);
      $("status").textContent = `ã‚²ãƒ¼ãƒ ã‚¯ãƒªã‚¢ï¼ãŠã‚ã§ã¨ã†ï¼`;
      $("input").disabled = true;
      document.body.style.backgroundColor = "#fff";
      document.body.style.color = "#000";
    }

    function checkLevelUp() {
      if (player.exp >= player.nextExp) {
        player.level++;
        player.exp -= player.nextExp;
        player.nextExp = Math.floor(player.nextExp * 1.5);
        player.attack += 100;
        $("status").textContent = `ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ Lv.${player.level} ã«ãªã£ãŸï¼`;
      }
    }

    function enemyAttack() {
      if (currentEnemy.hp > 0 && player.hp > 0) {
        const damage = 1800; // ãƒ‡ãƒ“ãƒ«ã‚µãƒ³ã‚ºã®æ”»æ’ƒãƒ€ãƒ¡ãƒ¼ã‚¸
        player.hp = Math.max(player.hp - damage, 0);
        showDamage(damage, true);
        updateStatus();
        if (player.hp <= 0) {
          handleGameOver();
        }
      }
    }


    function resetEnemyAttackTimer() {
        clearInterval(enemyAttackInterval);
        const intervalTime = 2000; // 0.1ç§’
        enemyAttackInterval = setInterval(enemyAttack, intervalTime);
    }
    
    // ã‚¨ãƒ©ãƒ¼è§£æ¶ˆã®ãŸã‚ã€handleStorySkip ã‚’ DOMContentLoaded ã®å‰ã«ç§»å‹•
    function handleStorySkip(e) {
        if (e.key.toLowerCase() === 's' && $("story-screen").style.display === "flex") {
            skipStory();
        }
    }

    function skipStory() {
        storyTimeouts.forEach(clearTimeout);
        $("story-screen").classList.remove("fade-in");
        $("story-screen").style.display = "none";
        $("start-screen").style.display = "block";
        document.removeEventListener("keydown", handleStorySkip);

        // èƒŒæ™¯ç”»åƒã‚’å…ƒã«æˆ»ã™ï¼ˆã‚²ãƒ¼ãƒ ç”»é¢ã®CSSèƒŒæ™¯ã«æˆ»ã‚‹ï¼‰
        document.body.style.backgroundImage = "";
        document.body.style.backgroundSize = "";
        document.body.style.backgroundPosition = "";
    }

    function startGame() {
      $("start-screen").style.display = "none";
      $("game-container").style.display = "block";
      setNewEnemy();
      setNewText();
      updateStatus();
      $("input").focus();
    }

    // showStory é–¢æ•°ã‚’ä¿®æ­£ã—ã€èƒŒæ™¯è¨­å®šã®é‡è¤‡ã‚’ãªãã™
    function showStory(index = 0) {
      const storyScreen = $("story-screen");
      const storyTextElement = $("story-text");

      // ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã®èƒŒæ™¯ã‚’è¨­å®š (é‡è¤‡ã‚’è§£æ¶ˆã—ã€ã“ã“ã«é›†ç´„)
      document.body.style.backgroundImage = "url('harumi-haikei.png')";
      document.body.style.backgroundSize = "cover";
      document.body.style.backgroundPosition = "center center";
      
      storyScreen.style.display = "flex";
      storyScreen.classList.add("fade-in");

      if (index < storyText.length) {
        storyTextElement.textContent = storyText[index];
        storyTextElement.style.opacity = 1;
        
        storyTimeouts.push(setTimeout(() => {
          storyTextElement.style.opacity = 0;
        }, 3000));

        storyTimeouts.push(setTimeout(() => {
          showStory(index + 1);
        }, 5000));
      } else {
        skipStory();
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.body.classList.add("ready");
      document.addEventListener("keydown", handleStorySkip); 
      $("start-button").addEventListener("click", startGame);
      $("input").addEventListener("keydown", handleInput);
      showStory();
    });
  </script>

</body>
</html>
