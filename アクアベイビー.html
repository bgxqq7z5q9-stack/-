

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>„ÅØ„Çã„Åø„Çø„Ç§„Éî„É≥„Ç∞</title>
  <style>
    body {
      font-family: sans-serif;
      background: linear-gradient(#e0f7fa, #ffffff);
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: black;
      opacity: 0;
      transition: opacity 0.5s ease-in;
    }
    body.ready {
      opacity: 1;
    }
    body.dragon-background {
      background: url("doukutu.png") no-repeat center center fixed;
      background-size: cover;
    }
    body.wizard-background { 
      background: url("") no-repeat center center fixed;
      background-size: cover;
    }
    body.devilsans-background {
      background: url("devilsans-background.png") no-repeat center center fixed;
      background-size: cover;
    }

    .story-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      color: white;
      display: none;
      justify-content: center;
      align-items: center;
      text-align: center;
      font-size: 2.5em;
      opacity: 0;
      transition: opacity 1s ease-in-out;
      z-index: 10;
    }

    .story-text {
      opacity: 0;
      transition: opacity 2s ease-in-out;
      padding: 20px;
    }

    .story-screen.fade-in {
      opacity: 1;
    }
    .story-screen.fade-out {
      opacity: 0;
    }

    .game-container {
      max-width: 800px;
      padding: 20px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 16px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: relative;
      display: none;
    }

    .start-screen {
      text-align: center;
      padding: 50px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 16px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 600px;
      width: 90%;
      display: none;
    }

    .start-screen h1 {
      font-size: 3em;
      margin-bottom: 20px;
    }

    .start-screen button {
      padding: 15px 30px;
      font-size: 1.5em;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background-color: #4CAF50;
      color: white;
      transition: background-color 0.3s;
    }

    .start-screen button:hover {
      background-color: #45a049;
    }

    .character-images {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .character-images img {
      width: 100px;
      image-rendering: pixelated;
    }

    .damage-effect {
      position: absolute;
      font-size: 1.4em;
      font-weight: bold;
      color: red;
      animation: float-up 0.8s ease-out forwards;
      pointer-events: none;
      z-index: 20;
    }

    @keyframes float-up {
      0% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-40px); }
    }

    h1 {
      text-align: center;
      font-size: 2em;
      margin-bottom: 10px;
    }

    #kana-text, #target-text, #combo {
      text-align: center;
      font-size: 1.2em;
      margin: 8px 0;
    }
    #status {
      text-align: center;
      font-size: 1.8em;
      font-weight: bold;
      margin: 8px 0;
    }

    #target-text span {
      color: #ccc;
    }

    #input {
      opacity: 0;
      position: absolute;
    }

    .hp-container {
      margin: 10px 0;
    }

    progress {
      width: 100%;
      height: 20px;
      appearance: none;
      border-radius: 10px;
      background: #eee;
    }

    progress::-webkit-progress-value {
      background: #53a318;
      border-radius: 10px;
    }

    .status-panel {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="story-screen" id="story-screen">
    <div id="story-text" class="story-text"></div>
  </div>

  <div class="start-screen" id="start-screen">
    <h1>üî•„ÅØ„Çã„Åø„Çø„Ç§„Éî„É≥„Ç∞üî•</h1>
    <button id="start-button">„Ç≤„Éº„É†„Çπ„Çø„Éº„Éà</button>
  </div>

  <div class="game-container" id="game-container">
    <h1>üî•„ÅØ„Çã„Åø„Çø„Ç§„Éî„É≥„Ç∞üî•</h1>
    <a href="index.html" class="back-to-list-link">Êïµ„É™„Çπ„Éà„Å´Êàª„Çã</a>

    <div class="status-panel">
      <div>„É¨„Éô„É´: <span id="level">1</span></div>
      <div>ÁµåÈ®ìÂÄ§: <span id="exp">0</span></div>
      <div>„Çπ„ÉÜ„Éº„Ç∏: <span id="stage">3</span></div>
    </div>

    <div class="character-images">
      <img id="player-image" src="hero.png" alt="„ÅÇ„Å™„Åü">
      <img id="enemy-image" src="" alt="Êïµ" />
    </div>

    <div id="enemy-name">??? „ÅåÁèæ„Çå„ÅüÔºÅ</div>
    <div id="kana-text">„ÅäÈ°åÔºöloading...</div>
    <div id="target-text">loading...</div>

    <input id="input" type="text" autocomplete="off" autofocus />

    <div class="hp-container">
      <div>„ÅÇ„Å™„Åü„ÅÆHP: <span id="player-hp-text">40000</span></div>
      <progress id="player-hp-bar" max="60000" value="60000"></progress>
    </div>
    <div class="hp-container">
      <div>Êïµ„ÅÆHP: <span id="enemy-hp-text">100</span></div>
      <progress id="enemy-hp-bar" max="100" value="100"></progress>
    </div>

    <div id="combo">„Ç≥„É≥„Éú: 0</div>
    <div id="status"></div>
  </div>

  <audio id="bgm" src="Record (online-voice-recorder.com) (1) (1).mp3" autoplay loop></audio>

  <script>
    const kanaToRomajiMap = {
      „ÅÇ:['a'],„ÅÑ:['i'],„ÅÜ:['u'],„Åà:['e'],„Åä:['o'],
      „Åã:['ka'],„Åç:['ki'],„Åè:['ku'],„Åë:['ke'],„Åì:['ko'],
      „Åï:['sa'],„Åó:['shi','si'],„Åô:['su'],„Åõ:['se'],„Åù:['so'],
      „Åü:['ta'],„Å°:['chi','ti'],„Å§:['tsu','tu'],„Å¶:['te'],„Å®:['to'],
      „Å™:['na'],„Å´:['ni'],„Å¨:['nu'],„Å≠:['ne'],„ÅÆ:['no'],
      „ÅØ:['ha'],„Å≤:['hi'],„Åµ:['fu','hu'],„Å∏:['he'],„Åª:['ho'],
      „Åæ:['ma'],„Åø:['mi'],„ÇÄ:['mu'],„ÇÅ:['me'],„ÇÇ:['mo'],
      „ÇÑ:['ya'],„ÇÜ:['yu'],„Çà:['yo'],
      „Çâ:['ra'],„Çä:['ri'],„Çã:['ru'],„Çå:['re'],„Çç:['ro'],
      „Çè:['wa'],„Çí:['wo','o'],„Çì:['n','nn'],
      „Åå:['ga'],„Åé:['gi'],„Åê:['gu'],„Åí:['ge'],„Åî:['go'],
      „Åñ:['za'],„Åò:['ji','zi'],„Åö:['zu','du'],„Åú:['ze'],„Åû:['zo'],
      „Å†:['da'],„Å¢:['ji','di'],„Å•:['zu','du'],„Åß:['de'],„Å©:['do'],
      „Å∞:['ba'],„Å≥:['bi'],„Å∂:['bu'],„Åπ:['be'],„Åº:['bo'],
      „Å±:['pa'],„Å¥:['pi'],„Å∑:['pu'],„Å∫:['pe'],„ÅΩ:['po'],
      „Åç„ÇÉ:['kya'],„Åç„ÇÖ:['kyu'],„Åç„Çá:['kyo'],
      „Åó„ÇÉ:['sha','sya'],„Åó„ÇÖ:['shu','syu'],„Åó„Çá:['sho','syo'],
      „Å°„ÇÉ:['cha','tya'],„Å°„ÇÖ:['chu','tyu'],„Å°„Çá:['cho','tyo'],
      „Å´„ÇÉ:['nya'],„Å´„ÇÖ:['nyu'],„Å´„Çá:['nyo'],
      „Å≤„ÇÉ:['hya'],„Å≤„ÇÖ:['hyu'],„Å≤„Çá:['hyo'],
      „Åø„ÇÉ:['mya'],„Åø„ÇÖ:['myu'],„Åø„Çá:['myo'],
      „Çä„ÇÉ:['rya'],„Çä„ÇÖ:['ryu'],„Çä„Çá:['ryo'],
      „Åé„ÇÉ:['gya'],„Åé„ÇÖ:['gyu'],„Åé„Çá:['gyo'],
      „Åò„ÇÉ:['ja','jya','zya'],„Åò„ÇÖ:['ju','jyu','zyu'],„Åò„Çá:['jo','jyo','zyo'],
      „Å≥„ÇÉ:['bya'],„Å≥„ÇÖ:['byu'],„Å≥„Çá:['byo'],
      „Å¥„ÇÉ:['pya'],„Å¥„ÇÖ:['pyu'],„Å¥„Çá:['pyo'],
    };

    const enemies = [
      { name: "„Ç¢„ÇØ„Ç¢„Éô„Ç§„Éì„Éº", maxHp: 20000, img: "„Ç¢„ÇØ„Ç¢„Éô„Ç§„Éì„Éº.png", attack: 10, exp: 10000 }
    ];
    
    const texts = ["„Å§„Åç„Åó„Åæ„Å†„ÅÑ„Åï„Çì„Åó„Çá„ÅÜ„Åå„Å£„Åì„ÅÜ", "„ÅØ„Çã„Åø„ÅÆ„Çå„Åç„Åó", "„ÅÜ„ÇÅ„Åü„Å¶„Å°", "„ÅÇ„Åä„Åû„Çâ", "„Å§„Åç„Åó„Åæ", "„ÅØ„Çã„Åø„ÅØ„ÅÜ„Åø„Å´„Åã„Åì„Åæ„Çå„Å¶„ÅÑ„Çã", "„ÇÇ„Çì„Åò„ÇÉ„ÅØ„Åä„ÅÑ„Åó„ÅÑ„Å™","„ÅØ„Çã„Åø„Å®„Çä„Å®„Çì","„Å§„Åç„Åó„Åæ„Çà„Çì„Åî„ÅÜ„Å°","„ÅÜ„ÇÅ„Åü„Å¶„Å°","„ÅØ„Çã„Åø„Å°„ÇÖ„ÅÜ„Åå„Å£„Åì„ÅÜ","„ÅØ„Çã„Åø„Åù„ÅÜ„Åî„ÅÜ„Åì„ÅÜ„Åì„ÅÜ","„ÅØ„Çã„Åø„Åµ„Å®„ÅÜ","„ÅØ„Çã„Åø„Åµ„Å®„ÅÜ„Åì„ÅÜ„Åà„Çì","„Å§„Åç„Åó„Åæ„Åê„Çâ„ÅÜ„Çì„Å©","„Çå„ÅÑ„ÇÅ„ÅÑ„Å∞„Åó„Åì„ÅÜ„Åà„Çì","„Çä„Çì„Åã„ÅÑ„Åì„ÅÜ„Åà„Çì","„ÅØ„Çã„Åø„Åó„Çá„ÅÜ„Å≠„Çì„Åê„Çâ„ÅÜ„Çì„Å©","„ÅØ„Çã„Åø„Åµ„Çâ„Å£„Åê","„ÅÇ„Çã„Åè„Åª„Å©„ÅÜ","„Å®„Çä„Å®„Çì„Å∂„Çä„Å£„Åò"];
    
    const storyText = [
      "Êô¥Êµ∑„Å´„ÅØÂç±Èô∫„Å™ÁîüÁâ©‚Ä¶",
      "„Åù„ÅÆÂêç„ÇÇ„Äå„ÅØ„Çã„ÇÇ„Çì„Äç„ÅåÁèæ„Çå„Åü",
      "Âπ≥Âíå„ÅÆ„Åü„ÇÅ„Å´Êô¥Êµ∑„ÇíÁü•„Çä„Å™„Åå„Çâ",
      "„ÅØ„Çã„ÇÇ„Çì„Çí„Åü„Åä„Åù„ÅÜÔºÅ",
    ];

    const player = { hp: 60000, maxHp: 60000, attack: 400, level: 99, exp: 0, nextExp: 1000 };
    let currentEnemy = {}, combo = 0, romajiList = [], romajiProgress = "";
    let stage = 3;
    let enemyAttackInterval;

    const $ = id => document.getElementById(id);
    
    function convertKanaToRomajiList(kana) {
        const result = [];
        let i = 0;
        while (i < kana.length) {
            let found = false;

            // ‰øÉÈü≥„ÅÆÂá¶ÁêÜ: „Äå„Å£„ÄçÔºãÊ¨°„ÅÆÊñáÂ≠ó„ÅÆÊúÄÂàù
            if (kana[i] === '„Å£' && i + 1 < kana.length) {
                const nextKana = kana.slice(i + 1, i + 2);
                const nextRomajiCandidates = kanaToRomajiMap[nextKana];
                if (nextRomajiCandidates) {
                    const firstRomajiChar = nextRomajiCandidates[0].charAt(0);
                    result.push([firstRomajiChar, firstRomajiChar]);
                    i++;
                    found = true;
                }
            }

            if (!found) {
                // 2ÊñáÂ≠ó„Åã„Å™„ÅÆÂá¶ÁêÜ (ÊãóÈü≥„Å™„Å©)
                const two = kana.slice(i, i + 2);
                if (kanaToRomajiMap[two]) {
                    result.push(kanaToRomajiMap[two]);
                    i += 2;
                    found = true;
                }
            }

            if (!found) {
                // 1ÊñáÂ≠ó„Åã„Å™„ÅÆÂá¶ÁêÜ
                const one = kana.slice(i, i + 1);
                if (kanaToRomajiMap[one]) {
                    result.push(kanaToRomajiMap[one]);
                    i += 1;
                    found = true;
                }
            }
            
            // Â§âÊèõ„Åß„Åç„Å™„ÅÑÊñáÂ≠óÔºàÊº¢Â≠ó„Å™„Å©Ôºâ„ÅØ„Çπ„Ç≠„ÉÉ„Éó„Åô„Çã
            if (!found) {
                i++;
            }
        }
        return result;
    }

    function setNewEnemy() {
      const enemyIndex = Math.floor(Math.random() * enemies.length);
      currentEnemy = { ...enemies[enemyIndex] };
      currentEnemy.hp = currentEnemy.maxHp;
      $("enemy-image").src = currentEnemy.img;
      $("enemy-hp-bar").max = currentEnemy.maxHp;
      $("enemy-hp-bar").value = currentEnemy.hp;
      $("enemy-hp-text").textContent = currentEnemy.hp;
      $("enemy-name").textContent = `${currentEnemy.name} „ÅåÁèæ„Çå„ÅüÔºÅ`;
      document.body.classList.remove("dragon-background", "wizard-background", "devilsans-background");
      if (currentEnemy.name === "„Éá„Éì„É´„Çµ„É≥„Ç∫") document.body.classList.add("devilsans-background");
      resetEnemyAttackTimer();
    }

    function setNewText() {
      const kana = texts[Math.floor(Math.random() * texts.length)];
      $("kana-text").textContent = `„ÅäÈ°åÔºö${kana}`;
      romajiList = convertKanaToRomajiList(kana);
      romajiProgress = "";
      updateTargetText();
    }
    
    function updateTargetText() {
        if (romajiList.length === 0) {
            $("target-text").innerHTML = "";
            return;
        }
        let typedRomajiPart = '';
        let remainingRomajiPart = '';
        let typedIndex = 0;
        let romajiIndex = 0;
        while(romajiIndex < romajiList.length && typedIndex < romajiProgress.length) {
            const romajiOptions = romajiList[romajiIndex];
            const remainingTyped = romajiProgress.slice(typedIndex);
            const bestMatch = romajiOptions.find(option => remainingTyped.startsWith(option));
            if (bestMatch) {
                typedRomajiPart += bestMatch;
                typedIndex += bestMatch.length;
                romajiIndex++;
            } else {
                const partialMatch = romajiOptions.find(option => option.startsWith(remainingTyped));
                if (partialMatch) {
                    typedRomajiPart += remainingTyped;
                    typedIndex += remainingTyped.length;
                }
                break;
            }
        }
        for (let i = romajiIndex; i < romajiList.length; i++) {
            remainingRomajiPart += romajiList[i][0];
        }
        $("target-text").innerHTML = `<span style="color: #ccc;">${typedRomajiPart}</span>${remainingRomajiPart}`;
    }

    function showDamage(dmg, isPlayerDamage = false) {
      const e = document.createElement("div");
      e.className = "damage-effect";
      e.textContent = `-${dmg}`;
      if (isPlayerDamage) {
        e.style.color = 'blue';
        const playerImageRect = $("player-image").getBoundingClientRect();
        e.style.top = `${playerImageRect.top + window.scrollY}px`;
        e.style.left = `${playerImageRect.left + playerImageRect.width / 2 + window.scrollX}px`;
      } else {
        e.style.color = 'red';
        const enemyImageRect = $("enemy-image").getBoundingClientRect();
        e.style.top = `${enemyImageRect.top + window.scrollY}px`;
        e.style.left = `${enemyImageRect.left + enemyImageRect.width / 2 + window.scrollX}px`;
      }
      document.body.appendChild(e);
      e.addEventListener('animationend', () => e.remove());
    }

    function updateStatus() {
      $("player-hp-text").textContent = player.hp;
      $("player-hp-bar").value = player.hp;
      $("enemy-hp-text").textContent = currentEnemy.hp;
      $("enemy-hp-bar").value = currentEnemy.hp;
      $("combo").textContent = `„Ç≥„É≥„Éú: ${combo}`;
      $("level").textContent = player.level;
      $("exp").textContent = player.exp;
      $("stage").textContent = stage;
    }
    
    function handleInput(e) {
      const key = e.key.toLowerCase();
      if (key === 'backspace') {
          if (romajiProgress.length > 0) {
              romajiProgress = romajiProgress.slice(0, -1);
              updateTargetText();
          }
          return;
      }
      if (!/^[a-z]$/.test(key)) {
          return;
      }
      if (romajiList.length === 0) {
          return;
      }
      const currentRomajiOptions = romajiList[0];
      const typedRomaji = romajiProgress + key;
      const isCorrectPartial = currentRomajiOptions.some(option => option.startsWith(typedRomaji));

      if (isCorrectPartial) {
          romajiProgress = typedRomaji;
          updateTargetText();
          
          const isCompleted = currentRomajiOptions.some(option => option === romajiProgress);
          if (isCompleted) {
              const damage = player.attack + combo * 5;
              currentEnemy.hp = Math.max(currentEnemy.hp - damage, 0);
              showDamage(damage);
              romajiList.shift();
              romajiProgress = "";
              combo++;
              player.exp += 10;
              
              if (romajiList.length === 0) {
                  player.exp += currentEnemy.exp;
                  if (currentEnemy.hp <= 0) {
                      handleEnemyDefeat();
                  }
                  setNewText();
              }
          }
      } else {
          combo = 0;
          $("status").textContent = "„Éü„ÇπÔºÅ";
          setTimeout(() => {
              $("status").textContent = "";
          }, 500);
          romajiProgress = "";
          updateTargetText();
      }
      updateStatus();
      if (player.hp <= 0) {
          handleGameOver();
      }
    }

    function handleEnemyDefeat() {
      $("status").textContent = `${currentEnemy.name} „ÇíÂÄí„Åó„ÅüÔºÅ`;
      player.exp += currentEnemy.exp;
      checkLevelUp();
      if (stage < 1) {
        stage++;
        setTimeout(() => {
          $("status").textContent = `Ê¨°„ÅÆÊïµ„ÅåÁèæ„Çå„ÅüÔºÅ „Çπ„ÉÜ„Éº„Ç∏${stage}`;
          setNewEnemy();
          setNewText();
          updateStatus();
        }, 1500);
      } else {
        handleGameClear();
      }
    }
    
    function handleGameOver() {
      clearInterval(enemyAttackInterval);
      $("status").textContent = "„Ç≤„Éº„É†„Ç™„Éº„Éê„Éº...";
      $("input").disabled = true;
      document.body.style.backgroundColor = "#333";
      document.body.style.color = "#000";
    }

    function handleGameClear() {
      clearInterval(enemyAttackInterval);
      $("status").textContent = `„Ç≤„Éº„É†„ÇØ„É™„Ç¢ÔºÅ„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ`;
      $("input").disabled = true;
      document.body.style.backgroundColor = "#fff";
      document.body.style.color = "#000";
    }

    function checkLevelUp() {
      if (player.exp >= player.nextExp) {
        player.level++;
        player.exp -= player.nextExp;
        player.nextExp = Math.floor(player.nextExp * 1.5);
        player.attack += 100;
        $("status").textContent = `„É¨„Éô„É´„Ç¢„ÉÉ„ÉóÔºÅ Lv.${player.level} „Å´„Å™„Å£„ÅüÔºÅ`;
      }
    }

    function enemyAttack() {
      if (currentEnemy.hp > 0 && player.hp > 0) {
        const damage = 3000; // „Éá„Éì„É´„Çµ„É≥„Ç∫„ÅÆÊîªÊíÉ„ÉÄ„É°„Éº„Ç∏
        player.hp = Math.max(player.hp - damage, 0);
        showDamage(damage, true);
        updateStatus();
        if (player.hp <= 0) {
          handleGameOver();
        }
      }
    }


 function resetEnemyAttackTimer() {
        clearInterval(enemyAttackInterval);
        const intervalTime = 1000; // 0.1Áßí
        enemyAttackInterval = setInterval(enemyAttack, intervalTime);
    }

    
    let storyTimeouts = [];
    
    // ...Ôºà‰∏≠Áï•Ôºâ...

    function skipStory() {
        storyTimeouts.forEach(clearTimeout);
        $("story-screen").classList.remove("fade-in");
        $("story-screen").style.display = "none";
        $("start-screen").style.display = "block";
        document.removeEventListener("keydown", handleStorySkip);

        // ËÉåÊôØÁîªÂÉè„ÇíÂÖÉ„Å´Êàª„Åô
        document.body.style.backgroundImage = "";
        document.body.style.backgroundSize = "";
        document.body.style.backgroundPosition = "";
    }

    // ...Ôºà‰∏≠Áï•Ôºâ...

    function showStory(index = 0) {
      const storyScreen = $("story-screen");
      const storyTextElement = $("story-text");

      // „Çπ„Éà„Éº„É™„Éº„ÅÆËÉåÊôØ„ÇíË®≠ÂÆö
      document.body.style.backgroundImage = "url('harumi-haikei.png')";
      document.body.style.backgroundSize = "cover";
      document.body.style.backgroundPosition = "center center";
      
      storyScreen.style.display = "flex";
      storyScreen.classList.add("fade-in");

      if (index < storyText.length) {
        storyTextElement.textContent = storyText[index];
        storyTextElement.style.opacity = 1;
        
        storyTimeouts.push(setTimeout(() => {
          storyTextElement.style.opacity = 0;
        }, 3000));

        storyTimeouts.push(setTimeout(() => {
          showStory(index + 1);
        }, 5000));
      } else {
        skipStory();
      }
    }

    // ...ÔºàÂæåÁï•Ôºâ...
    

function skipStory() {
        storyTimeouts.forEach(clearTimeout);
        $("story-screen").classList.remove("fade-in");
        $("story-screen").style.display = "none";
        $("start-screen").style.display = "block";
        document.removeEventListener("keydown", handleStorySkip);

        // ËÉåÊôØÁîªÂÉè„ÇíÂÖÉ„Å´Êàª„Åô
        document.body.style.backgroundImage = "";
        document.body.style.backgroundSize = "";
        document.body.style.backgroundPosition = "";
    }

  // „Çπ„Éà„Éº„É™„Éº„ÅÆËÉåÊôØ„ÇíË®≠ÂÆö
      document.body.style.backgroundImage = "url('harumi-haikei.png')";
      document.body.style.backgroundSize = "cover";
      document.body.style.backgroundPosition = "center center";
    
    function handleStorySkip(e) {
        if (e.key.toLowerCase() === 's' && $("story-screen").style.display === "flex") {
            skipStory();
        }
    }

    function startGame() {
      $("start-screen").style.display = "none";
      $("game-container").style.display = "block";
      setNewEnemy();
      setNewText();
      updateStatus();
      $("input").focus();
    }

    function showStory(index = 0) {
      const storyScreen = $("story-screen");
      const storyTextElement = $("story-text");
      
      storyScreen.style.display = "flex";
      storyScreen.classList.add("fade-in");

      if (index < storyText.length) {
        storyTextElement.textContent = storyText[index];
        storyTextElement.style.opacity = 1;
        
        storyTimeouts.push(setTimeout(() => {
          storyTextElement.style.opacity = 0;
        }, 3000));

        storyTimeouts.push(setTimeout(() => {
          showStory(index + 1);
        }, 5000));
      } else {
        skipStory();
      }
    }


    function showStory(index = 0) {
      const storyScreen = $("story-screen");
      const storyTextElement = $("story-text");
     
      storyScreen.style.display = "flex";
      storyScreen.classList.add("fade-in");

      if (index < storyText.length) {
        storyTextElement.textContent = storyText[index];
        storyTextElement.style.opacity = 1;
        
        storyTimeouts.push(setTimeout(() => {
          storyTextElement.style.opacity = 0;
        }, 3000));

        storyTimeouts.push(setTimeout(() => {
          showStory(index + 1);
        }, 5000));
      } else {
        skipStory();
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      document.body.classList.add("ready");
      document.addEventListener("keydown", handleStorySkip);
      showStory();
      $("start-button").addEventListener("click", startGame);
      $("input").addEventListener("keydown", handleInput);
    });
  </script>
</body>
</html>


